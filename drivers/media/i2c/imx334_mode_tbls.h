/*
 * imx334_mode_tbls.h - imx334 sensor mode tables
 *
 * Copyright (C) 2021, Leopard  <leopard@leopardimaging.com>
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms and conditions of the GNU General Public License,
 * version 2, as published by the Free Software Foundation.
 *
 * This program is distributed in the hope it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
#ifndef __IMX334_I2C_TABLES__
#define __IMX334_I2C_TABLES__

#include <media/camera_common.h>
#include <linux/miscdevice.h>

#define IMX334_TABLE_WAIT_MS	0
#define IMX334_TABLE_END	1
#define IMX334_MAX_RETRIES	3
#define IMX334_WAIT_MS_STOP		50
#define IMX334_WAIT_MS_START	30
#define IMX334_WAIT_MS_STREAM	210

#define IMX334_STANDBY_REG 		0x3000
#define XVS_XHS_DRV          	0x31A1

/* #define INIT_ET_INSETTING 1 */

#define imx334_reg struct reg_8

static imx334_reg imx334_start[] = {
	{0x31A0, 0x2A},
	{0x31D4, 0x00},
	{0x31D5, 0x00},
	{0x37B0, 0x36},
	{0x31D9, 0x00},
	{0x31A1, 0x00},

	{IMX334_STANDBY_REG, 0x0},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{0x3002, 0x00},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STREAM},
	{ IMX334_TABLE_END, 0x00 }
};

static imx334_reg imx334_slave_start[] = {
	{0x37B0, 0x37},
	{0x31D9, 0x01},
	{0x31A1, 0x0F},

	{IMX334_STANDBY_REG, 0x0},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{0x3002, 0x00},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STREAM},
	{ IMX334_TABLE_END, 0x00 }
};

static imx334_reg imx334_stop[] = {
	{0x3002, 0x01},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STOP},
	{IMX334_STANDBY_REG, 0x1},
	// {0x3004, 0x00},
	{IMX334_TABLE_END, 0x00}
};
static imx334_reg imx334_stop_slave[] = {
	{IMX334_STANDBY_REG, 0x1},
	{0x3004, 0x00},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STOP},
	{IMX334_TABLE_END, 0x00 }
};

static  imx334_reg imx334_3864x2180_60fps[] = {
	{IMX334_STANDBY_REG, 0x01},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{0x3003, 0x00},
	{0x3004, 0x00},
	{0x300C, 0x5B},

	{0x300D, 0x40},
	{0x3018, 0x00},
	{0x302C, 0x30},
	{0x302D, 0x00},

	{0x302E, 0x18},
	{0x302F, 0x0F},
	// {0x3030, 0x5E},
	// {0x3031, 0x1A},
	{0x3030, 0xCA},
	{0x3031, 0x08},
	{0x3032, 0x00},
	{0x3033, 0x00},

	// {0x3034, 0x4c},
	// {0x3035, 0x04},
	{0x3034, 0x26},
	{0x3035, 0x02},

	{0x304C, 0x14},
	{0x304E, 0x00},
	{0x304F, 0x00},

	{0x3050, 0x01},
	{0x3058, 0x05},
	{0x3059, 0x00},
	{0x305A, 0x00},

	{0x3074, 0xB0},
	{0x3075, 0x00},
	{0x3076, 0x84},
	{0x3077, 0x08},
	{0x3078, 0x02},
	{0x3079, 0x00},
	{0x307A, 0x00},
	{0x307B, 0x00},
	{0x3080, 0x02},
	{0x3081, 0x00},
	{0x3082, 0x00},
	{0x3083, 0x00},
	{0x3088, 0x02},


	{0x308E, 0xB1},
	{0x308F, 0x00},

	{0x3090, 0x84},
	{0x3091, 0x08},
	{0x3094, 0x00},
	{0x3095, 0x00},
	{0x3096, 0x00},
	{0x309B, 0x02},
	{0x309C, 0x00},
	{0x309D, 0x00},
	{0x309E, 0x00},
	{0x30A4, 0x00},
	{0x30A5, 0x00},

	{0x30B6, 0x00},
	{0x30B7, 0x00},
	{0x30C6, 0x00},
	{0x30C7, 0x00},
	{0x30CE, 0x00},
	{0x30CF, 0x00},
	{0x30D8, 0xF8},
	{0x30D9, 0x11},

	{0x30E8, 0x00},
	{0x30E9, 0x00},
	{0x3116, 0x08},
	{0x3117, 0x00},
	{0x314C, 0xC0},
	{0x314D, 0x00},
	{0x315A, 0x02},
	{0x3168, 0x68},
	{0x316A, 0x7E},
	{0x3199, 0x00},

	{0x319D, 0x01},
	{0x319E, 0x00},

	{0x31DD, 0x03},

	{0x3288, 0x21},
	{0x328A, 0x02},
	{0x3300, 0x00},
	{0x3302, 0x32},
	{0x3303, 0x00},
	{0x3308, 0x84},
	{0x3309, 0x08},

	{0x3414, 0x05},
	{0x3416, 0x18},
	{0x341C, 0x47},
	{0x341D, 0x00},

	{0x35AC, 0x0E},
	{0x3648, 0x01},
	{0x364A, 0x04},
	{0x364C, 0x04},
	{0x3678, 0x01},
	{0x367C, 0x31},
	{0x367E, 0x31},

	{0x3708, 0x02},
	{0x3714, 0x01},
	{0x3715, 0x02},
	{0x3716, 0x02},
	{0x3717, 0x02},
	{0x371C, 0x3D},
	{0x371D, 0x3F},

	{0x372C, 0x00},
	{0x372D, 0x00},
	{0x372E, 0x46},
	{0x372F, 0x00},
	{0x3730, 0x89},
	{0x3731, 0x00},
	{0x3732, 0x08},
	{0x3733, 0x01},
	{0x3734, 0xFE},
	{0x3735, 0x05},

	{0x375D, 0x00},
	{0x375E, 0x00},
	{0x375F, 0x61},
	{0x3760, 0x06},
	{0x3768, 0x1B},
	{0x3769, 0x1B},
	{0x376A, 0x1A},
	{0x376B, 0x19},
	{0x376C, 0x18},
	{0x376D, 0x14},
	{0x376E, 0x0F},

	{0x3776, 0x00},
	{0x3777, 0x00},
	{0x3778, 0x46},
	{0x3779, 0x00},
	{0x377A, 0x08},
	{0x377B, 0x01},
	{0x377C, 0x45},
	{0x377D, 0x01},
	{0x377E, 0x23},
	{0x377F, 0x02},
	{0x3780, 0xD9},
	{0x3781, 0x03},
	{0x3782, 0xF5},
	{0x3783, 0x06},
	{0x3784, 0xA5},

	{0x3788, 0x0F},
	{0x378A, 0xD9},
	{0x378B, 0x03},
	{0x378C, 0xEB},
	{0x378D, 0x05},
	{0x378E, 0x87},
	{0x378F, 0x06},
	{0x3790, 0xF5},
	{0x3792, 0x43},
	{0x3794, 0x7A},
	{0x3796, 0xA1},

	{0x3A01, 0x03},

	{0x3A18, 0xB7},
	{0x3A19, 0x00},
	{0x3A1A, 0x67},
	{0x3A1B, 0x00},
	{0x3A1C, 0x6F},
	{0x3A1D, 0x00},
	{0x3A1E, 0xDF},
	{0x3A1F, 0x01},
	{0x3A20, 0x6F},
	{0x3A21, 0x00},
	{0x3A22, 0xCF},
	{0x3A23, 0x00},
	{0x3A24, 0x6F},
	{0x3A25, 0x00},
	{0x3A26, 0xB7},
	{0x3A27, 0x00},
	{0x3A28, 0x5F},
	{0x3A29, 0x00},
	{0x3E04, 0x0E},
	{IMX334_STANDBY_REG, 0x0},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STREAM},
	{IMX334_STANDBY_REG, 0x1},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{IMX334_TABLE_END, 0x00}
};

static  imx334_reg imx334_3864x2180_30fps[] = {
	{IMX334_STANDBY_REG, 0x01},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{0x3003, 0x00},
	{0x3004, 0x00},
	{0x300C, 0x5B},

	{0x300D, 0x40},
	{0x3018, 0x00},
	{0x302C, 0x30},
	{0x302D, 0x00},

	{0x302E, 0x18},
	{0x302F, 0x0F},
	{0x3030, 0x94},	//VMAX
	{0x3031, 0x11},
	// {0x3030, 0xCA},
	// {0x3031, 0x08},
	{0x3032, 0x00},
	{0x3033, 0x00},

	// {0x3034, 0x4c},
	// {0x3035, 0x04},
	{0x3034, 0x26},
	{0x3035, 0x02},

	{0x304C, 0x14},
	{0x304E, 0x00},
	{0x304F, 0x00},

	{0x3050, 0x01},
	{0x3058, 0x05},
	{0x3059, 0x00},
	{0x305A, 0x00},

	{0x3074, 0xB0},
	{0x3075, 0x00},
	{0x3076, 0x84},
	{0x3077, 0x08},
	{0x3078, 0x02},
	{0x3079, 0x00},
	{0x307A, 0x00},
	{0x307B, 0x00},
	{0x3080, 0x02},
	{0x3081, 0x00},
	{0x3082, 0x00},
	{0x3083, 0x00},
	{0x3088, 0x02},


	{0x308E, 0xB1},
	{0x308F, 0x00},

	{0x3090, 0x84},
	{0x3091, 0x08},
	{0x3094, 0x00},
	{0x3095, 0x00},
	{0x3096, 0x00},
	{0x309B, 0x02},
	{0x309C, 0x00},
	{0x309D, 0x00},
	{0x309E, 0x00},
	{0x30A4, 0x00},
	{0x30A5, 0x00},

	{0x30B6, 0x00},
	{0x30B7, 0x00},
	{0x30C6, 0x00},
	{0x30C7, 0x00},
	{0x30CE, 0x00},
	{0x30CF, 0x00},
	{0x30D8, 0xF8},
	{0x30D9, 0x11},

	{0x30E8, 0x00},
	{0x30E9, 0x00},
	{0x3116, 0x08},
	{0x3117, 0x00},
	{0x314C, 0xC0},
	{0x314D, 0x00},
	{0x315A, 0x02},
	{0x3168, 0x68},
	{0x316A, 0x7E},
	{0x3199, 0x00},

	{0x319D, 0x01},
	{0x319E, 0x00},

	{0x31DD, 0x03},

	{0x3288, 0x21},
	{0x328A, 0x02},
	{0x3300, 0x00},
	{0x3302, 0x32},
	{0x3303, 0x00},
	{0x3308, 0x84},
	{0x3309, 0x08},

	{0x3414, 0x05},
	{0x3416, 0x18},
	{0x341C, 0x47},
	{0x341D, 0x00},

	{0x35AC, 0x0E},
	{0x3648, 0x01},
	{0x364A, 0x04},
	{0x364C, 0x04},
	{0x3678, 0x01},
	{0x367C, 0x31},
	{0x367E, 0x31},

	{0x3708, 0x02},
	{0x3714, 0x01},
	{0x3715, 0x02},
	{0x3716, 0x02},
	{0x3717, 0x02},
	{0x371C, 0x3D},
	{0x371D, 0x3F},

	{0x372C, 0x00},
	{0x372D, 0x00},
	{0x372E, 0x46},
	{0x372F, 0x00},
	{0x3730, 0x89},
	{0x3731, 0x00},
	{0x3732, 0x08},
	{0x3733, 0x01},
	{0x3734, 0xFE},
	{0x3735, 0x05},

	{0x375D, 0x00},
	{0x375E, 0x00},
	{0x375F, 0x61},
	{0x3760, 0x06},
	{0x3768, 0x1B},
	{0x3769, 0x1B},
	{0x376A, 0x1A},
	{0x376B, 0x19},
	{0x376C, 0x18},
	{0x376D, 0x14},
	{0x376E, 0x0F},

	{0x3776, 0x00},
	{0x3777, 0x00},
	{0x3778, 0x46},
	{0x3779, 0x00},
	{0x377A, 0x08},
	{0x377B, 0x01},
	{0x377C, 0x45},
	{0x377D, 0x01},
	{0x377E, 0x23},
	{0x377F, 0x02},
	{0x3780, 0xD9},
	{0x3781, 0x03},
	{0x3782, 0xF5},
	{0x3783, 0x06},
	{0x3784, 0xA5},

	{0x3788, 0x0F},
	{0x378A, 0xD9},
	{0x378B, 0x03},
	{0x378C, 0xEB},
	{0x378D, 0x05},
	{0x378E, 0x87},
	{0x378F, 0x06},
	{0x3790, 0xF5},
	{0x3792, 0x43},
	{0x3794, 0x7A},
	{0x3796, 0xA1},

	{0x3A01, 0x03},

	{0x3A18, 0xB7},
	{0x3A19, 0x00},
	{0x3A1A, 0x67},
	{0x3A1B, 0x00},
	{0x3A1C, 0x6F},
	{0x3A1D, 0x00},
	{0x3A1E, 0xDF},
	{0x3A1F, 0x01},
	{0x3A20, 0x6F},
	{0x3A21, 0x00},
	{0x3A22, 0xCF},
	{0x3A23, 0x00},
	{0x3A24, 0x6F},
	{0x3A25, 0x00},
	{0x3A26, 0xB7},
	{0x3A27, 0x00},
	{0x3A28, 0x5F},
	{0x3A29, 0x00},
	{0x3E04, 0x0E},
	{IMX334_STANDBY_REG, 0x0},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STREAM},
	{IMX334_STANDBY_REG, 0x1},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{IMX334_TABLE_END, 0x00}
};

static  imx334_reg imx334_3864x2180_10fps[] = {
	{IMX334_STANDBY_REG, 0x01},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{0x3003, 0x00},
	{0x3004, 0x00},
	{0x300C, 0x5B},

	{0x300D, 0x40},
	{0x3018, 0x00},
	{0x302C, 0x30},
	{0x302D, 0x00},

	{0x302E, 0x18},
	{0x302F, 0x0F},
	{0x3030, 0xBc},	//VMAX
	{0x3031, 0x34},
	{0x3032, 0x00},
	{0x3033, 0x00},

	// {0x3034, 0x4c},
	// {0x3035, 0x04},
	{0x3034, 0x26},
	{0x3035, 0x02},

	{0x304C, 0x14},
	{0x304E, 0x00},
	{0x304F, 0x00},

	{0x3050, 0x01},
	{0x3058, 0x05},
	{0x3059, 0x00},
	{0x305A, 0x00},

	{0x3074, 0xB0},
	{0x3075, 0x00},
	{0x3076, 0x84},
	{0x3077, 0x08},
	{0x3078, 0x02},
	{0x3079, 0x00},
	{0x307A, 0x00},
	{0x307B, 0x00},
	{0x3080, 0x02},
	{0x3081, 0x00},
	{0x3082, 0x00},
	{0x3083, 0x00},
	{0x3088, 0x02},


	{0x308E, 0xB1},
	{0x308F, 0x00},

	{0x3090, 0x84},
	{0x3091, 0x08},
	{0x3094, 0x00},
	{0x3095, 0x00},
	{0x3096, 0x00},
	{0x309B, 0x02},
	{0x309C, 0x00},
	{0x309D, 0x00},
	{0x309E, 0x00},
	{0x30A4, 0x00},
	{0x30A5, 0x00},

	{0x30B6, 0x00},
	{0x30B7, 0x00},
	{0x30C6, 0x00},
	{0x30C7, 0x00},
	{0x30CE, 0x00},
	{0x30CF, 0x00},
	{0x30D8, 0xF8},
	{0x30D9, 0x11},

	{0x30E8, 0x00},
	{0x30E9, 0x00},
	{0x3116, 0x08},
	{0x3117, 0x00},
	{0x314C, 0xC0},
	{0x314D, 0x00},
	{0x315A, 0x02},
	{0x3168, 0x68},
	{0x316A, 0x7E},
	{0x3199, 0x00},

	{0x319D, 0x01},
	{0x319E, 0x00},

	{0x31DD, 0x03},

	{0x3288, 0x21},
	{0x328A, 0x02},
	{0x3300, 0x00},
	{0x3302, 0x32},
	{0x3303, 0x00},
	{0x3308, 0x84},
	{0x3309, 0x08},

	{0x3414, 0x05},
	{0x3416, 0x18},
	{0x341C, 0x47},
	{0x341D, 0x00},

	{0x35AC, 0x0E},
	{0x3648, 0x01},
	{0x364A, 0x04},
	{0x364C, 0x04},
	{0x3678, 0x01},
	{0x367C, 0x31},
	{0x367E, 0x31},

	{0x3708, 0x02},
	{0x3714, 0x01},
	{0x3715, 0x02},
	{0x3716, 0x02},
	{0x3717, 0x02},
	{0x371C, 0x3D},
	{0x371D, 0x3F},

	{0x372C, 0x00},
	{0x372D, 0x00},
	{0x372E, 0x46},
	{0x372F, 0x00},
	{0x3730, 0x89},
	{0x3731, 0x00},
	{0x3732, 0x08},
	{0x3733, 0x01},
	{0x3734, 0xFE},
	{0x3735, 0x05},

	{0x375D, 0x00},
	{0x375E, 0x00},
	{0x375F, 0x61},
	{0x3760, 0x06},
	{0x3768, 0x1B},
	{0x3769, 0x1B},
	{0x376A, 0x1A},
	{0x376B, 0x19},
	{0x376C, 0x18},
	{0x376D, 0x14},
	{0x376E, 0x0F},

	{0x3776, 0x00},
	{0x3777, 0x00},
	{0x3778, 0x46},
	{0x3779, 0x00},
	{0x377A, 0x08},
	{0x377B, 0x01},
	{0x377C, 0x45},
	{0x377D, 0x01},
	{0x377E, 0x23},
	{0x377F, 0x02},
	{0x3780, 0xD9},
	{0x3781, 0x03},
	{0x3782, 0xF5},
	{0x3783, 0x06},
	{0x3784, 0xA5},

	{0x3788, 0x0F},
	{0x378A, 0xD9},
	{0x378B, 0x03},
	{0x378C, 0xEB},
	{0x378D, 0x05},
	{0x378E, 0x87},
	{0x378F, 0x06},
	{0x3790, 0xF5},
	{0x3792, 0x43},
	{0x3794, 0x7A},
	{0x3796, 0xA1},

	{0x3A01, 0x03},

	{0x3A18, 0xB7},
	{0x3A19, 0x00},
	{0x3A1A, 0x67},
	{0x3A1B, 0x00},
	{0x3A1C, 0x6F},
	{0x3A1D, 0x00},
	{0x3A1E, 0xDF},
	{0x3A1F, 0x01},
	{0x3A20, 0x6F},
	{0x3A21, 0x00},
	{0x3A22, 0xCF},
	{0x3A23, 0x00},
	{0x3A24, 0x6F},
	{0x3A25, 0x00},
	{0x3A26, 0xB7},
	{0x3A27, 0x00},
	{0x3A28, 0x5F},
	{0x3A29, 0x00},
	{0x3E04, 0x0E},
	{IMX334_STANDBY_REG, 0x0},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_STREAM},
	{IMX334_STANDBY_REG, 0x1},
	{IMX334_TABLE_WAIT_MS, IMX334_WAIT_MS_START},
	{IMX334_TABLE_END, 0x00}
};

enum {
	IMX334_MODE_3864x2180_60FPS,
	IMX334_MODE_3864x2180_10FPS,
	IMX334_MODE_3864x2180_30FPS,
	IMX334_MODE_START_STREAM,
	IMX334_MODE_STOP_STREAM,
	IMX334_MODE_START_STREAM_SLAVE,
	IMX334_MODE_STOP_STREAM_SLAVE,
};

static imx334_reg *mode_table[] = {
	[IMX334_MODE_3864x2180_60FPS] = imx334_3864x2180_60fps,
	[IMX334_MODE_3864x2180_10FPS] = imx334_3864x2180_10fps,
	[IMX334_MODE_3864x2180_30FPS] = imx334_3864x2180_30fps,
	[IMX334_MODE_START_STREAM] = imx334_start,
	[IMX334_MODE_STOP_STREAM] = imx334_stop,
	[IMX334_MODE_START_STREAM_SLAVE]
	= imx334_slave_start,
	[IMX334_MODE_STOP_STREAM_SLAVE]
	= imx334_stop_slave,
};

static u32 imx334_frame_length[] = {
	[IMX334_MODE_3864x2180_60FPS] = 2250,
	[IMX334_MODE_3864x2180_10FPS] = 13500,
	[IMX334_MODE_3864x2180_30FPS] = 4500,
};

static const int imx334_10fps[] = {
	10,
};
static const int imx334_30fps[] = {
	30,
};
static const int imx334_60fps[] = {
	60,
};

static const struct camera_common_frmfmt imx334_frmfmt[] = {
	{{3864, 2180}, imx334_60fps, 1, 0,
			IMX334_MODE_3864x2180_60FPS},
	{{3864, 2180}, imx334_10fps, 1, 0,
			IMX334_MODE_3864x2180_10FPS},
	{{3864, 2180}, imx334_30fps, 1, 0,
			IMX334_MODE_3864x2180_30FPS},
	/* Add modes with no device tree support after below */
};
#endif /* __IMX334_I2C_TABLES__ */
